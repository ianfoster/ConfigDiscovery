name: openbabel
hpc_system: polaris
endpoint_id: 0554c761-5a62-474d-b26e-df7455682bba
environment:
  conda_env: openbabel_env
  conda_packages:
    - openbabel
installation:
  steps:
    - conda create -n openbabel_env -c conda-forge openbabel python=3.11 -y
  verification: |
    source /soft/applications/conda/2025-09-25/mconda3/etc/profile.d/conda.sh && \
    conda activate openbabel_env && obabel -V
execution:
  function: |
    def run_openbabel(input_format="smi", output_format="xyz", input_data="CCO", output_dir="openbabel_output"):
        """Convert molecular formats using Open Babel."""
        import subprocess
        import os

        output_dir = os.path.abspath(output_dir)
        os.makedirs(output_dir, exist_ok=True)

        input_file = os.path.join(output_dir, f"input.{input_format}")
        output_file = os.path.join(output_dir, f"output.{output_format}")

        with open(input_file, "w") as f:
            f.write(input_data)

        conda = "source /soft/applications/conda/2025-09-25/mconda3/etc/profile.d/conda.sh && conda activate openbabel_env && "
        cmd = f"{conda}obabel {input_file} -O {output_file} --gen3d"
        result = subprocess.run(cmd, shell=True, capture_output=True, text=True, timeout=60)

        output_content = ""
        if os.path.exists(output_file):
            with open(output_file) as f:
                output_content = f.read()

        return {
            "status": "completed" if result.returncode == 0 else "failed",
            "input_format": input_format,
            "output_format": output_format,
            "output": output_content[:1000],
            "output_file": output_file
        }
  function_name: run_openbabel
  resources:
    nodes: 1
    cores_per_node: 1
    memory_gb: 4
discovery_log:
  discovered_date: '2026-02-12'
  attempts: 1
tags: [cheminformatics, conversion, molecules, formats]
